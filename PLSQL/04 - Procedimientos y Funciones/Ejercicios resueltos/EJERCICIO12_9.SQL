CREATE OR REPLACE FUNCTION F_OBTENER_CALIFICACION (COD_CLI IN NUMBER) RETURN VARCHAR IS
    OPERACIONES_CO NUMBER := 0;
    OPERACIONES_CR NUMBER := 0;
BEGIN
    SELECT 
        NVL(SUM(V.MONTO_TOTAL), 0)
    INTO OPERACIONES_CO
    FROM B_PERSONAS P
    INNER JOIN B_VENTAS V ON P.ID = V.ID_CLIENTE
    WHERE P.ID = COD_CLI AND V.TIPO_VENTA = 'CO';

    SELECT 
        NVL(SUM(MONTO_CUOTA), 0)
    INTO OPERACIONES_CR
    FROM B_PERSONAS P
    INNER JOIN B_VENTAS V ON P.ID = V.ID_CLIENTE
    INNER JOIN B_PLAN_PAGO PP ON V.ID = PP.ID_VENTA
    WHERE P.ID = COD_CLI 
        AND TRUNC(PP.FECHA_PAGO) <= TRUNC(PP.VENCIMIENTO) AND V.TIPO_VENTA = 'CR';

    IF (OPERACIONES_CO + OPERACIONES_CR) >= 15000000 THEN
        RETURN 'A';
    ELSIF (OPERACIONES_CO + OPERACIONES_CR) >= 8000000 AND OPERACIONES_CO + OPERACIONES_CR < 15000000 THEN
        RETURN 'B';
    ELSE
        RETURN 'C';
    END IF;
END;
/

	
	-- SHOW ERRORS FUNCTION F_OBTENER_CALIFICACION; ---> PARA VER ERRORES
	--PARA PROBAR
	--SELECT  NOMBRE, F_OBTENER_CALIFICACION(ID)
	--FROM B_PERSONAS