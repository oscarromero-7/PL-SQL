SET SERVEROUTPUT ON;
CREATE OR REPLACE PROCEDURE P_GENERAR_PLAN (P_ID_VENTA IN NUMBER) IS
	V_PLAZO B_VENTAS.PLAZO%TYPE;
	V_MONTO_TOTAL B_VENTAS.MONTO_TOTAL%TYPE;
	V_CUOTA B_PLAN_PAGO.NUMERO_CUOTA%TYPE;
	V_MONTO_CUOTA B_PLAN_PAGO.MONTO_CUOTA%TYPE;
	V_MONTO_PAGAR B_PLAN_PAGO.MONTO_CUOTA%TYPE;
	V_FECHA B_VENTAS.FECHA%TYPE;
	V_VENCIMIENTO B_VENTAS.FECHA%TYPE;
BEGIN
	SELECT 
		PLAZO,
		MONTO_TOTAL,
		FECHA
	INTO 
		V_PLAZO,
		V_MONTO_TOTAL,
		V_FECHA
	FROM B_VENTAS 
	WHERE ID = P_ID_VENTA;
	IF SQL%FOUND THEN 
		IF V_PLAZO > 1 THEN
			CASE V_PLAZO
				WHEN 30 THEN
					V_CUOTA := 1;
					V_MONTO_CUOTA := V_MONTO_TOTAL + (V_MONTO_TOTAL*0.015);
					V_VENCIMIENTO := V_FECHA + 30;
					DBMS_OUTPUT.PUT_LINE('CUOTA 1: '||'MONTO_CUOTA: '||TO_CHAR(V_MONTO_CUOTA,'999G999G999')||' VENCIMIENTO: '||V_VENCIMIENTO);
				WHEN 60 THEN
					V_CUOTA := 2;
					V_MONTO_PAGAR := V_MONTO_TOTAL/2 + ((V_MONTO_TOTAL/2)*0.03);
					V_VENCIMIENTO := V_FECHA + 30;
					DBMS_OUTPUT.PUT_LINE('CUOTA 1: '||'MONTO_CUOTA: '||TO_CHAR(V_MONTO_PAGAR,'999G999G999')||' VENCIMIENTO: '||V_VENCIMIENTO);
					V_VENCIMIENTO := V_VENCIMIENTO + 30;
					V_MONTO_PAGAR := V_MONTO_PAGAR + V_MONTO_PAGAR*0.03;
					DBMS_OUTPUT.PUT_LINE('CUOTA 2: '||'MONTO_CUOTA: '||TO_CHAR(V_MONTO_PAGAR,'999G999G999')||' VENCIMIENTO: '||V_VENCIMIENTO);
				WHEN 90 THEN
					V_CUOTA := 3;
					V_MONTO_PAGAR := V_MONTO_TOTAL/2 + ((V_MONTO_TOTAL/2)*0.05);
					V_VENCIMIENTO := V_FECHA + 30;
					DBMS_OUTPUT.PUT_LINE('CUOTA 1: '||'MONTO_CUOTA: '||TO_CHAR(V_MONTO_PAGAR,'999G999G999')||' VENCIMIENTO: '||V_VENCIMIENTO);
					V_VENCIMIENTO := V_VENCIMIENTO + 30;
					V_MONTO_PAGAR := V_MONTO_PAGAR + V_MONTO_PAGAR*0.03;
					DBMS_OUTPUT.PUT_LINE('CUOTA 2: '||'MONTO_CUOTA: '||TO_CHAR(V_MONTO_PAGAR,'999G999G999')||' VENCIMIENTO: '||V_VENCIMIENTO);
					V_VENCIMIENTO := V_VENCIMIENTO + 30;
					V_MONTO_PAGAR := V_MONTO_PAGAR + V_MONTO_PAGAR*0.03;
					DBMS_OUTPUT.PUT_LINE('CUOTA 3: '||'MONTO_CUOTA: '||TO_CHAR(V_MONTO_PAGAR,'999G999G999')||' VENCIMIENTO: '||V_VENCIMIENTO);
			END CASE;	
		ELSE
			DBMS_OUTPUT.PUT_LINE('EL CLIENTE COMPRO A CONTADO');
		END IF;
	END IF;
EXCEPTION
		WHEN NO_DATA_FOUND THEN
			-- Manejo de excepciÃ³n cuando no se encuentra ningÃºn dato
			DBMS_OUTPUT.PUT_LINE('No se encontrÃ³ informaciÃ³n ');
		WHEN OTHERS THEN
			-- Manejo de otras excepciones
			DBMS_OUTPUT.PUT_LINE('Error: ' || SQLCODE || ' - ' || SQLERRM);
END;
/
--EXEC P_GENERAR_PLAN(P_ID_VENTA => tu_id_de_venta);
