CREATE OR REPLACE FUNCTION F_OBTENER_SALDO_CRED (COD_CLI IN NUMBER) RETURN NUMBER IS
	OPERACIONES_CR  NUMBER;
	LIMITE NUMBER;
	BEGIN
		SELECT 
        NVL(SUM(MONTO_CUOTA), 0),
		DECODE(F_OBTENER_CALIFICACION(COD_CLI),'A',22000000,'B',18000000,10000000)
		INTO OPERACIONES_CR, LIMITE
		FROM B_PERSONAS P
		INNER JOIN B_VENTAS V ON P.ID = V.ID_CLIENTE
		INNER JOIN B_PLAN_PAGO PP ON V.ID = PP.ID_VENTA
		WHERE P.ID = COD_CLI AND PP.FECHA_PAGO IS NULL 
			AND V.TIPO_VENTA = 'CR';
		RETURN (LIMITE - OPERACIONES_CR);
	END;
	
	--SHOW ERRORS FUNCTION F_OBTENER_SALDO_CRED; ---> PARA VER ERRORES
	--PARA PROBAR
	 COL LIMITE_CREDITO FORMAT A
	SELECT  NOMBRE, 
			TO_CHAR(F_OBTENER_SALDO_CRED(ID),'999G999G999') AS LIMITE_CREDITOO,
			F_OBTENER_CALIFICACION(ID) AS CALIFICACION
	FROM B_PERSONAS
	WHERE ID = 5;