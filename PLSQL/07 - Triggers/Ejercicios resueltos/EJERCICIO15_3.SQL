CREATE OR REPLACE TR_BIDETALLE BEFORE INSERT ON B_DIARIO_DETALLE
FOR EACH ROW 
DECLARE
	V_FECHA DATE;
	V_ANIO NUMBER(4);
	V_MES NUMBER(2);
	AUX NUMBER(5);
	TIPO VARCHAR2(1);
BEGIN
	SELECT DC.FECHA
	INTO V_FECHA
	FROM B_DIARIO_CABECERA DC
	WHERE DC.ID = :NEW.ID;
	IF SQL%NOTFOUND THEN
		RAISE_APPLICATION_ERROR(-20001,'NO ES UN ID VALIDO');
	END IF;
	V_ANIO := EXTRACT(YEAR FROM V_FECHA);
	V_MES := EXTRACT(MONTH FROM V_FECHA);
	
	SELECT COUNT(*)
	INTO AUX
	FROM B_MAYOR M
	WHERE M.ANIO = V_ANIO AND M.MES = V_MES AND M.CODIGO_CTA = :NEW.CODIGO_CTA;
	
	IF AUX = 0 THEN
		RAISE_APPLICATION_ERROR(-20002,'AÃ‘O O MES YA CREADO');
	ELSE
		SELECT	C.ORDEN
		INTO V_TIPO
		FROM B_CUENTAS C
		WHERE C.CODIGO_CTA = :NEW.CODIGO_CTA;
		IF V_TIPO = 'D' THEN
			UPDATE B_MAYOR 
			SET ACUM_DEBITO = ACUM_DEBITO + :NEW.IMPORTE;
			WHERE CODIGO_CTA
		ELSE 
		
		END IF;
		I B_MAYOR VALUES (
		
		);
	END IF;
END;
/