CREATE OR REPLACE TRIGGER T_CONTROL_PA 
BEFORE INSERT OR DELETE ON B_POSICION_ACTUAL
FOR EACH ROW 
	DECLARE
	V_ACTUAL B_CATEGORIAS_SALARIALES.ASIGNACION%TYPE;
	V_ANTERIOR B_CATEGORIAS_SALARIALES.ASIGNACION%TYPE;
	V_CEDULA B_POSICION_ACTUAL.CEDULA%TYPE;
	BEGIN
		IF INSERTING THEN
			SELECT PA.CEDULA, CS.ASIGNACION
			INTO V_CEDULA, V_ANTERIOR
			FROM B_POSICION_ACTUAL PA
			INNER JOIN B_CATEGORIAS_SALARIALES CS ON PA.COD_CATEGORIA = CS.COD_CATEGORIA
			WHERE PA.FECHA_FIN IS NULL AND PA.CEDULA = :NEW.CEDULA;
			
			SELECT CS.ASIGNACION
			INTO V_ACTUAL
			FROM B_CATEGORIAS_SALARIALES CS
			WHERE CS.COD_CATEGORIA = :NEW.COD_CATEGORIA;
			IF V_ANTERIOR > V_ACTUAL  THEN
				RAISE_APPLICATION_ERROR(-20001,'NO PUEDE ASIGNAR UNA CATEGORIA CON SUELDO MENOR AL ACTUAL');
			END IF;
		ELSE
			RAISE_APPLICATION_ERROR(-20002,'NO PUEDE BORRAR REGISTROS');
		END IF;
	
	END;
/
/*
	PRUEBAS
-------------------------------------------------
INSERT INTO B_POSICION_ACTUAL VALUES(
(SELECT MAX(ID) + 1 FROM B_POSICION_ACTUAL),
2,
4433245,
4,
SYSDATE,
NULL
);
DELETE FROM B_POSICION_ACTUAL WHERE CEDULA = 4433245;
SELECT PA.CEDULA, CS.ASIGNACION
			--INTO V_CEDULA, V_ANTERIOR
			FROM B_POSICION_ACTUAL PA
			INNER JOIN B_CATEGORIAS_SALARIALES CS ON PA.COD_CATEGORIA = CS.COD_CATEGORIA
			WHERE PA.FECHA_FIN IS NULL AND PA.CEDULA = 4433245;*/