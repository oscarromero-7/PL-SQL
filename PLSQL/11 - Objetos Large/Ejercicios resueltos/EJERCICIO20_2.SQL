CREATE TABLE ARTICULOS_LARGE(
	ID_ARTICULO NUMBER(8),
	DESCRIPCION CLOB,
	IMAGEN BLOB
);
--INSERT DE UN CAMPO BLOB
DECLARE
    CURSOR C_ARTICULOS IS
        SELECT
            ID AS ID_ARTICULO,
            NOMBRE AS DESCRIPCION
        FROM B_ARTICULOS;
        
    NOMBRE_ARCHIVO VARCHAR2(100);
    ARCHIVO BFILE;
    V_BLOB BLOB;
BEGIN
    FOR REG IN C_ARTICULOS LOOP
        -- INSERTAMOS A ARTICULOS_LARGE LOS DATOS EXTRAIDOS DEL CURSOR
        INSERT INTO ARTICULOS_LARGE (ID_ARTICULO, DESCRIPCION, IMAGEN)
        VALUES (REG.ID_ARTICULO, REG.DESCRIPCION, EMPTY_BLOB())
        RETURNING IMAGEN INTO V_BLOB;
        
        NOMBRE_ARCHIVO := TRIM(BOTH FROM TO_CHAR(REG.ID_ARTICULO)) || '.gif';
        ARCHIVO := BFILENAME('MIS_BLOBS', NOMBRE_ARCHIVO);
        
        IF DBMS_LOB.FILEEXISTS(ARCHIVO) = 1 THEN
            DBMS_LOB.FILEOPEN(ARCHIVO, DBMS_LOB.FILE_READONLY);
            DBMS_LOB.LOADFROMFILE(V_BLOB, ARCHIVO, DBMS_LOB.GETLENGTH(ARCHIVO));
            DBMS_LOB.FILECLOSE(ARCHIVO);
            
            -- Actualizamos la imagen en ARTICULOS_LARGE
            UPDATE ARTICULOS_LARGE
            SET IMAGEN = V_BLOB
            WHERE ID_ARTICULO = REG.ID_ARTICULO;
        END IF;
    END LOOP;
    
    COMMIT;
END;
/
