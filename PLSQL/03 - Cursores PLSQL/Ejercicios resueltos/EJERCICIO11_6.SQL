
DECLARE
	CURSOR C_ARTICULOS IS
		SELECT 
			ID,
			NOMBRE,
			STOCK_MINIMO
		FROM B_ARTICULOS
		WHERE STOCK_ACTUAL < STOCK_MINIMO;
	V_PROVEEDOR B_COMPRAS.ID_PROVEEDOR%TYPE := NULL;
BEGIN
	FOR R_ARTICULOS IN C_ARTICULOS LOOP
		SELECT ID_PROVEEDOR
		INTO V_PROVEEDOR
		FROM B_COMPRAS C
		INNER JOIN B_DETALLE_COMPRAS DC ON C.ID = DC.ID_COMPRA
		WHERE DC.ID_ARTICULO = R_ARTICULOS.ID 
		ORDER BY C.FECHA DESC
		FETCH FIRST 1 ROWS ONLY;
		IF SQL%FOUND THEN
			DBMS_OUTPUT.PUT_LINE(R_ARTICULOS. NOMBRE ||' ID: '||R_ARTICULOS.ID||' STOCK_MIN: '||R_ARTICULOS.STOCK_MINIMO * 1.35||' ID PROVEEDOR: '||V_PROVEEDOR);
			INSERT INTO REPOSICION (CODIGO_ARTICULO, NOMBRE, CANT_PEDIR, ID_PROVEEDOR) VALUES (
				R_ARTICULOS.ID,
				R_ARTICULOS.NOMBRE,
				R_ARTICULOS.STOCK_MINIMO *1.35,
				V_PROVEEDOR
			);
		ELSE
			DBMS_OUTPUT.PUT_LINE(R_ARTICULOS. NOMBRE ||' ID: '||R_ARTICULOS.ID||' STOCK_MIN: '||R_ARTICULOS.STOCK_MINIMO * 1.35||' ID PROVEEDOR: '||V_PROVEEDOR);
			INSERT INTO REPOSICION (CODIGO_ARTICULO, NOMBRE, CANT_PEDIR, ID_PROVEEDOR) VALUES (
			R_ARTICULOS.ID,
			R_ARTICULOS.NOMBRE,
			R_ARTICULOS.STOCK_MINIMO *1.35,
			NULL
			);
		END IF;
	END LOOP;
END;
/