SET SERVEROUTPUT ON
ACCEPT VALOR_INGRESADO NUMBER PROMPT 'Ingrese Cedula: ';
DECLARE
	ANO_REPORTE NUMBER(4) := 2018;
	MONTO_REGULAR NUMBER(9) := 3000000;
	MONTO_BUENO NUMBER(9) := 10000000;
	TIPO_EMPLEADO VARCHAR2(15);
	VALOR B_EMPLEADOS.CEDULA%TYPE;
	MONTO_VENDIDO B_VENTAS.MONTO_TOTAL%TYPE;
	NOM_APE VARCHAR2(60);
	FECHA_INGRESO B_EMPLEADOS.FECHA_ING%TYPE;
BEGIN
	VALOR := &VALOR_INGRESADO;
	DBMS_OUTPUT.PUT_LINE('Cedula ingresada: ' || VALOR);
	BEGIN
		SELECT 	SUM(V.MONTO_TOTAL), E.NOMBRE ||' '||E.APELLIDO, E.FECHA_ING
		INTO 	MONTO_VENDIDO, NOM_APE, FECHA_INGRESO
		FROM B_EMPLEADOS E
		INNER JOIN B_VENTAS V ON E.CEDULA = V.CEDULA_VENDEDOR
		WHERE V.CEDULA_VENDEDOR = VALOR AND EXTRACT(YEAR FROM V.FECHA) = ANO_REPORTE
		GROUP BY E.NOMBRE ||' '||E.APELLIDO, E.FECHA_ING;
	EXCEPTION
        	WHEN NO_DATA_FOUND THEN
            		DBMS_OUTPUT.PUT_LINE('No se encontraron datos para la cédula ingresada.');
            		RETURN; -- Puedes usar RETURN para salir del bloque PL/SQL si no hay datos.
        WHEN OTHERS THEN
            	DBMS_OUTPUT.PUT_LINE('Error: ' || SQLCODE || ' - ' || SQLERRM);
            	RETURN;
	END;
	
	CASE 
	WHEN MONTO_VENDIDO < MONTO_REGULAR THEN
		TIPO_EMPLEADO := 'REGULAR';
	WHEN MONTO_VENDIDO > MONTO_REGULAR AND MONTO_VENDIDO < MONTO_BUENO THEN
		TIPO_EMPLEADO := 'BUENO';
	WHEN MONTO_VENDIDO > MONTO_BUENO THEN
		TIPO_EMPLEADO := 'EXCELENTE';
	END CASE;

	DBMS_OUTPUT.PUT_LINE('Cedula: '|| VALOR ||' ||  Nombre y Apellido: ' || NOM_APE);
	DBMS_OUTPUT.PUT_LINE('Monto vendido: ' ||TO_CHAR(MONTO_VENDIDO,'999G999G999') || ' ||  TIPO EMPLEADO: '|| TIPO_EMPLEADO);
	DBMS_OUTPUT.PUT_LINE('Año del reporte: ' || ANO_REPORTE || ' ||  FECHA_INGRESO: ' || FECHA_INGRESO);
END;
/