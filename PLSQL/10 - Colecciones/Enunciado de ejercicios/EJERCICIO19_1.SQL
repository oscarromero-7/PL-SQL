CREATE OR REPLACE TYPE CLIENTE AS OBJECT(
	ID_CLIENTE NUMBER(8),
	NOMBRE_CLIENTE VARCHAR2(100)
);

CREATE TYPE CLIENTES AS VARRAY(50) OF CLIENTE;

CREATE TABLE VENDEDORES (
	CEDUL_VENDEDOR NUMBER(11),
	NOMBRE_VENDEDOR VARCHAR(30),
	CLIENTES_VENDEDOR CLIENTES
);
CREATE OR REPLACE PROCEDURE P_LLENAR_TABLA IS
	CURSOR C_VENDEDORES IS
		SELECT DISTINCT
			V.CEDULA_VENDEDOR,
			E.NOMBRE||' '||E.APELLIDO AS NOM_APE
		FROM B_EMPLEADOS E
		INNER JOIN B_VENTAS V ON E.CEDULA = V.CEDULA_VENDEDOR;
	CURSOR C_CLIENTES (CED_VENDEDOR NUMBER)IS
		SELECT V.ID_CLIENTE,
			P.NOMBRE||' '||P.APELLIDO AS NOM_APE
		FROM B_EMPLEADOS E
		INNER JOIN B_VENTAS V ON E.CEDULA = V.CEDULA_VENDEDOR
		INNER JOIN B_PERSONAS P ON V.ID_CLIENTE = P.ID
		WHERE V.CEDULA_VENDEDOR = CED_VENDEDOR;
	LIST_CLIENTE CLIENTES := CLIENTES();
	I NUMBER(3);
BEGIN
	FOR REG_V IN C_VENDEDORES LOOP
		LIST_CLIENTE := CLIENTES();
		I := 1;
		FOR REG_C IN C_CLIENTES(REG_V.CEDULA_VENDEDOR) LOOP
			LIST_CLIENTE.EXTEND;
			-- CONSTRUCTOR DEL QUE HEREDO EL VARRAY CLIENTES PADRE ES CLIENTE
			LIST_CLIENTE(I):=CLIENTE(REG_C.ID_CLIENTE, REG_C.NOM_APE);
			I := I + 1;
		END LOOP;
		INSERT INTO VENDEDORES VALUES(
			REG_V.CEDULA_VENDEDOR,
			REG_V.NOM_APE,
			LIST_CLIENTE
		);
		LIST_CLIENTE.DELETE;
	END LOOP;

END;
/

UPDATE VENDEDORES
SET CLIENTES_VENDEDOR = (SELECT CLIENTES_VENDEDOR FROM VENDEDORES WHERE NOMBRE_VENDEDOR = 'Jorge Medina')
WHERE NOMBRE_VENDEDOR = 'Juan Villalba';
