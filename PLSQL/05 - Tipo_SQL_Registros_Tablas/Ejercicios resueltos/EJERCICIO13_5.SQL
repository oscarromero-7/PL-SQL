 CREATE OR REPLACE PROCEDURE P_DISTRIBUIR_CLIENTES IS
 
 
	TYPE T_REG IS RECORD (
		NOM_APE VARCHAR2(200),
		TELEFONO VARCHAR2(15),
		CEDULA_JEFE VARCHAR2(15),
		CANT_CLIENTE NUMBER(5)
	);
	TYPE TA_REG IS TABLE OF T_REG INDEX BY BINARY_INTEGER;
	
	
	TYPE R_DIV_RES IS RECORD (
		DIVISION NUMBER(5),
		RESTO NUMBER(5)
	);
	
	
	FUNCTION OBTENER_DIVISION RETURN R_DIV_RES IS
		RESULTADO R_DIV_RES;
		BEGIN
			SELECT
				TRUNC((SELECT COUNT(ID)
				FROM B_PERSONAS
				WHERE ES_CLIENTE = 'S') / (SELECT COUNT(E.CEDULA)
				FROM B_EMPLEADOS E
				INNER JOIN B_POSICION_ACTUAL PA ON E.CEDULA = PA.CEDULA
				INNER JOIN B_CATEGORIAS_SALARIALES CS ON PA.COD_CATEGORIA = CS.COD_CATEGORIA
				WHERE UPPER(CS.NOMBRE_CAT) LIKE '%VENDEDOR%')) DIVISION,
				MOD((SELECT COUNT(ID)
				FROM B_PERSONAS
				WHERE ES_CLIENTE = 'S'), (SELECT COUNT(E.CEDULA)
				FROM B_EMPLEADOS E
				INNER JOIN B_POSICION_ACTUAL PA ON E.CEDULA = PA.CEDULA
				INNER JOIN B_CATEGORIAS_SALARIALES CS ON PA.COD_CATEGORIA = CS.COD_CATEGORIA
				WHERE UPPER(CS.NOMBRE_CAT) LIKE '%VENDEDOR%')) RESTO
			INTO RESULTADO.DIVISION, RESULTADO.RESTO
			FROM DUAL;
			RETURN RESULTADO;
		END;
		
		
	BEGIN
		DECLARE
			RESULTADO R_DIV_RES;
			LIST_EMPLEADOS TA_REG;
		BEGIN
			RESULTADO := OBTENER_DIVISION;
			SELECT
				E.NOMBRE||' '||E.APELLIDO,
				E.TELEFONO,
				E.CEDULA_JEFE,
				RESULTADO.DIVISION
			BULK COLLECT INTO LIST_EMPLEADOS
			FROM B_EMPLEADOS E
			INNER JOIN B_POSICION_ACTUAL PA ON E.CEDULA = PA.CEDULA
			INNER JOIN B_CATEGORIAS_SALARIALES CS ON PA.COD_CATEGORIA = CS.COD_CATEGORIA
			WHERE UPPER(CS.NOMBRE_CAT) LIKE '%VENDEDOR%';
			
			FOR I IN 1 .. LIST_EMPLEADOS.COUNT LOOP
				IF I = LIST_EMPLEADOS.COUNT AND RESULTADO.RESTO != 0 THEN
					LIST_EMPLEADOS(I).CANT_CLIENTE := RESULTADO.RESTO + RESULTADO.DIVISION ;
				END IF;
				DBMS_OUTPUT.PUT_LINE('NOM_APE: '||LIST_EMPLEADOS(I).NOM_APE);
				DBMS_OUTPUT.PUT_LINE('TELEFONO: '||LIST_EMPLEADOS(I).TELEFONO);
				DBMS_OUTPUT.PUT_LINE('CEDULA JEFE: '||LIST_EMPLEADOS(I).CEDULA_JEFE);
				DBMS_OUTPUT.PUT_LINE('CANT CLIENTES: '||LIST_EMPLEADOS(I).CANT_CLIENTE);
				DBMS_OUTPUT.PUT_LINE('--------------------------------------------------');				
			END LOOP;
		END;
	END;
	
	--SHOW ERRORS PROCEDURE P_DISTRIBUIR_CLIENTES;
	BEGIN
		P_DISTRIBUIR_CLIENTES;
	END;