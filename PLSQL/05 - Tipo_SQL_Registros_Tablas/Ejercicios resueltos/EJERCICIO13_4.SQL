CREATE OR REPLACE PROCEDURE P_CATEGORIAS (CI IN NUMBER) IS
	TYPE R_CAT IS RECORD (
		V_CATEGORIA VARCHAR2(30),
		SALARIO NUMBER(8),
		FECHA_INICIO_VIGENCIA DATE
	);
	TYPE T_CAT IS TABLE OF R_CAT INDEX BY BINARY_INTEGER;
	LEGAJO_EMPLEADO T_CAT;
	
	FUNCTION LEGAJO (CIE IN NUMBER) RETURN T_CAT IS
		V_CAT T_CAT;
		BEGIN
			SELECT 
				CS.NOMBRE_CAT,
				CS.ASIGNACION,
				CS.FECHA_INI
			BULK COLLECT INTO V_CAT
			FROM B_CATEGORIAS_SALARIALES CS
			INNER JOIN B_POSICION_ACTUAL PA ON CS.COD_CATEGORIA = PA.COD_CATEGORIA
			WHERE PA.CEDULA = CIE;
			RETURN V_CAT;
		EXCEPTION
			WHEN NO_DATA_FOUND THEN
				DBMS_OUTPUT.PUT_LINE('NO SE ENCONTRO EL EMPLEADO.');
			WHEN OTHERS THEN
				-- Manejo de otras excepciones
				DBMS_OUTPUT.PUT_LINE('Error: ' || SQLCODE || ' - ' || SQLERRM);
		END LEGAJO;
		
	BEGIN
		LEGAJO_EMPLEADO := LEGAJO(CI);
		DBMS_OUTPUT.PUT_LINE('LEGAJO DEL EMPLEADO');
		FOR I IN 1 .. LEGAJO_EMPLEADO.COUNT LOOP
			DBMS_OUTPUT.PUT_LINE('CEDULA: '||CI||' CATEGORIA: '||LEGAJO_EMPLEADO(I).V_CATEGORIA||' SALARIO: '||LEGAJO_EMPLEADO(I).SALARIO||' FECHA INICIO: '||LEGAJO_EMPLEADO(I).FECHA_INICIO_VIGENCIA);
		END LOOP;
	END;
	/
	--SHOW ERRORS PROCEDURE P_CATEGORIAS; --> PARA VER ERRORES
	--BEGIN
	--	P_CATEGORIAS(2608701);
	--END;
