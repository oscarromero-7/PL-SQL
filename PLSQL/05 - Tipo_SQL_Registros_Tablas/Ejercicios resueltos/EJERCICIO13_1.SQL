CREATE OR REPLACE PROCEDURE P_ESTADISTICA_ARTICULOS IS
    TYPE R_ARTICULOS IS RECORD (
        ID_ARTICULO NUMBER,
        NOMBRE_ARTICULO VARCHAR2(40),
        MONTO_COMPRAS NUMBER,
        MONTO_VENTAS NUMBER
    );
    
    TYPE ART IS TABLE OF R_ARTICULOS INDEX BY BINARY_INTEGER;
    T_ARTICULOS ART;
BEGIN
    --COMPRAS 2018 VENTAS 2018
     
    SELECT 	
    A.ID,
    A.NOMBRE,
    NVL(SUM(DC.CANTIDAD * DC.PRECIO_COMPRA),0) COMPRA, 
    NVL(SUM(DV.CANTIDAD * DV.PRECIO),0) VENTA
	BULK COLLECT INTO T_ARTICULOS
	FROM B_ARTICULOS A
	LEFT JOIN B_DETALLE_COMPRAS DC ON A.ID = DC.ID_ARTICULO
	LEFT JOIN B_DETALLE_VENTAS DV ON A.ID = DV.ID_ARTICULO
	LEFT JOIN B_COMPRAS C ON DC.ID_COMPRA = C.ID
	LEFT JOIN B_VENTAS V ON DV.ID_VENTA = V.ID
	WHERE EXTRACT(YEAR FROM V.FECHA) = 2018
	GROUP BY A.ID, A.NOMBRE;

    FOR I IN 1 .. T_ARTICULOS.COUNT LOOP
        DBMS_OUTPUT.PUT_LINE('ID: ' || T_ARTICULOS(I).ID_ARTICULO);
        DBMS_OUTPUT.PUT_LINE('NOMBRE: ' || T_ARTICULOS(I).NOMBRE_ARTICULO);
        DBMS_OUTPUT.PUT_LINE('MONTO_COMPRAS: ' || T_ARTICULOS(I).MONTO_COMPRAS);
        DBMS_OUTPUT.PUT_LINE('MONTO_VENTAS: ' || T_ARTICULOS(I).MONTO_VENTAS);
    END LOOP;
	DBMS_OUTPUT.PUT_LINE('LONGITUD DEL ARRAY: ' || T_ARTICULOS.COUNT);
END;

	--SHOW ERRORS PROCEDURE P_ESTADISTICA_ARTICULOS;	---> PARA VER ERRORES