ACCEPT I_ID PROMPT 'Ingrese ID area: ';
ACCEPT I_NOMBRE PROMPT 'Ingrese nombre del area: ';
ACCEPT I_OPERACION PROMPT 'Ingrese tipo de operacion (A - B - M): '; 
SET SERVEROUTPUT ON
DECLARE
	V_ID_AREA B_AREAS.ID%TYPE;
	V_NOM_AREA B_AREAS.NOMBRE_AREA%TYPE;
	V_OPERACION VARCHAR2(1);
	OPERACION_NO_DEFINIDA EXCEPTION;
	CONTADOR NUMBER(1) := 0;
	INVALID_ID EXCEPTION;
	PRAGMA EXCEPTION_INIT (INVALID_ID, -00001);
	CLAVE_INEXISTENTE EXCEPTION;
	v_error_code NUMBER;
	v_error_message VARCHAR2(255);

BEGIN
	V_ID_AREA := &I_ID;
	V_NOM_AREA := '&I_NOMBRE';
	V_OPERACION := UPPER('&I_OPERACION');
	-- A = ALTAS B = BAJAS M = MODIFICACIONES
	IF V_OPERACION IN ('A', 'B', 'M') THEN
		IF V_OPERACION = 'A' THEN
			BEGIN
				INSERT INTO B_AREAS VALUES (V_ID_AREA, V_NOM_AREA, SYSDATE,'S', 1);
				DBMS_OUTPUT.PUT_LINE('Área agregada con éxito.');
				COMMIT;
			EXCEPTION
				WHEN INVALID_ID THEN
					DBMS_OUTPUT.PUT_LINE('CLAVE DUPLICADA');
			END;
		
		ELSIF V_OPERACION = 'B' THEN
			BEGIN
				SELECT COUNT(*) INTO CONTADOR
				FROM B_AREAS
				WHERE ID = V_ID_AREA;
				-- Si NO encuentra, es error
				IF NVL(CONTADOR,0) = 0 THEN
					RAISE CLAVE_INEXISTENTE;
				ELSE
					DELETE FROM B_AREAS WHERE ID = V_ID_AREA;
					DBMS_OUTPUT.PUT_LINE('Área borrada con éxito.');
				END IF;
			EXCEPTION
				WHEN CLAVE_INEXISTENTE THEN
					DBMS_OUTPUT.PUT_LINE('CLAVE INEXISTENTE');
				WHEN OTHERS THEN
					ROLLBACK;
					v_error_code := SQLCODE;
					v_error_message := SQLERRM;
					DBMS_OUTPUT.PUT_LINE (TO_CHAR(v_error_code)||': '|| v_error_message);
			END;
		END IF;
		IF V_OPERACION = 'M' THEN
			BEGIN
				UPDATE B_AREAS
				SET NOMBRE_AREA = V_NOM_AREA
				WHERE ID = V_ID_AREA;
				DBMS_OUTPUT.PUT_LINE('Área modificada con éxito.');
				COMMIT;
			EXCEPTION
				WHEN CLAVE_INEXISTENTE THEN
					DBMS_OUTPUT.PUT_LINE('CLAVE INEXISTENTE');
			END;	
		
		END IF;
	ELSE
		RAISE OPERACION_NO_DEFINIDA;
	END IF;
EXCEPTION
	WHEN OPERACION_NO_DEFINIDA THEN
		DBMS_OUTPUT.PUT_LINE('Utilizar los rangos habilitados por el ORACLE');	
		
END;
/